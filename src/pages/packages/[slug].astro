---
import '../../styles/globals.css';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import LeadForm from '@/components/LeadForm.astro';
import FAQ from '@/components/FAQ.astro';
import { packages } from '@/data/packages';
import { destinations } from '@/data/destinations';
import pricing from '@/data/pricing.json';
import Analytics from '@/components/Analytics.astro';

export async function getStaticPaths() {
  return packages.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const entry = packages.find((p) => p.slug === slug);
if (!entry) return Astro.redirect('/');

const band = pricing.packages?.[slug!];
const dest = destinations.find(d => d.slug.replace(/^\/packages\//, '') === slug);
const WA = (import.meta.env.PUBLIC_WHATSAPP_NUMBER || '+919922333305').replace(/\D/g, '');
const waText = encodeURIComponent(`Hi Axis Cabs ðŸ‘‹\nI'm interested in "${entry.title}". Please share details.`);
const waHref = `https://wa.me/${WA}?text=${waText}`;
function formatINR(n: number) {
  try {
    return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(n);
  } catch {
    return `â‚¹${n.toLocaleString('en-IN')}`;
  }
}
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{entry.title}</title>
    <meta name="description" content={entry.summary} />
    <link rel="icon" href="/favicon.svg" />
    <Analytics />
  </head>
  <body>
    <Header />
    {entry.images.length > 0 && (
      <section class="overflow-hidden">
        <div class="flex overflow-x-auto snap-x snap-mandatory">
          {entry.images.map(img => (
            <img src={img.src} alt={img.alt} class="w-full h-64 md:h-96 object-cover flex-shrink-0 snap-center" />
          ))}
        </div>
      </section>
    )}
    <section class="max-w-6xl mx-auto px-4 py-6">
      <h1 class="text-3xl font-bold">{entry.title}</h1>
      <p class="mt-2 text-lg opacity-80">{entry.summary}</p>
      {dest && (
        <div class="mt-4 flex flex-wrap gap-2">
          {dest.highlights.map(h => <span class="text-xs font-medium px-2.5 py-1 rounded-full bg-gray-100">{h}</span>)}
        </div>
      )}
      {dest && (
        <div class="mt-4 flex flex-wrap items-center gap-4">
          <span class="text-2xl font-bold">{formatINR(dest.priceFromINR)}</span>
          <span class="opacity-70">{dest.duration}</span>
        </div>
      )}
      <div class="mt-4 flex gap-3">
        <a href={waHref} class="inline-flex items-center px-5 py-3 rounded-xl border border-primary font-semibold">Chat on WhatsApp</a>
        <a href="#lead-form" class="btn-primary">Book / Get Quote</a>
      </div>
    </section>
    <main class="mx-auto max-w-6xl px-4 grid md:grid-cols-3 gap-8">
      <div class="md:col-span-2">
        <section class="card">
          <h2 class="text-xl font-bold">Price Bands</h2>
          <p class="opacity-80 mt-2">
            Sedan â‚¹{band?.sedan_band?.[0] ?? 'â€”'}â€“â‚¹{band?.sedan_band?.[1] ?? 'â€”'}
            â€¢ SUV â‚¹{band?.suv_band?.[0] ?? 'â€”'}â€“â‚¹{band?.suv_band?.[1] ?? 'â€”'}
          </p>
          <p class="text-sm mt-1 opacity-70">Inclusions: AC cab, fuel, driver allowance. Exclusions: entry tickets, meals, hotel.</p>
        </section>
        <section class="mt-6">
          <h3 class="text-lg font-bold mb-3">What you'll experience</h3>
          <div class="space-y-3">
            {entry.days.map((d) => (
              <details class="card">
                <summary class="cursor-pointer font-semibold">{d.day}</summary>
                <ul class="list-disc list-inside text-sm mt-2">
                  {d.items.map(i => <li>{i}</li>)}
                </ul>
              </details>
            ))}
            <details class="card">
              <summary class="cursor-pointer font-semibold">What's included?</summary>
              <ul class="list-disc list-inside text-sm mt-2">
                <li>AC cab with driver</li>
                <li>Fuel &amp; tolls</li>
              </ul>
            </details>
            <details class="card">
              <summary class="cursor-pointer font-semibold">What's not included?</summary>
              <ul class="list-disc list-inside text-sm mt-2">
                <li>Entry tickets</li>
                <li>Meals</li>
              </ul>
            </details>
          </div>
        </section>
        <section class="mt-6">
          <h3 class="text-lg font-bold mb-3">Get Your Quote</h3>
          <LeadForm />
        </section>
        {entry.faqs.length > 0 && (
          <section class="mt-6">
            <h3 class="text-lg font-bold mb-3">FAQ</h3>
            <FAQ items={entry.faqs} />
          </section>
        )}
      </div>
      <aside class="space-y-4">
        <div class="card"><strong>Why Axis Cabs?</strong><p class="text-sm mt-2 opacity-80">Local expertise â€¢ Flexible timing â€¢ Premium support</p></div>
      </aside>
    </main>
    <Footer />
  </body>
</html>
